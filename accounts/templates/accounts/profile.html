{% extends 'base.html' %}

{% block content %}

<section class="container">
    <h1>{{ profile_user.username }} 의 프로필</h1>
    <hr>
    {% for group in user.groups.all %}
    {% if group.name == 'register' %}
        <h2>등록 목록</h2>
        <hr>
        {% include 'sidebar.html' %}
        <div class="row">
        {% for hotel_infoes in profile_user.hotel_infoes.all %}
            <div class="col-sm-4 mb-5">
                <div class="card">
                    <div class="card-body">
                        <a href="{% url 'hotel:detail_hotel_info' hotel_infoes.pk %}">
                            {{ hotel_infoes.name }} 
                        </a>
                        <span>평점 : {{ hotel_infoes.score }}</span>
                        <hr>
                        {% if hotel_infoes.price == 0 %}
                            <span>상품이 없습니다.</span>
                        {% else %}
                            {% for hotel_products in hotel_infoes.products.all %}
                                <p class="card-text">{{ hotel_products.title }} : {{ hotel_products.price }}</p>
                            {% endfor %}
                        {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    {% elif group.name == 'client'%}
    <h2>예약 목록</h2>
    <hr>
    {% include 'sidebar.html' %}
    <div class="row">
        {% if book == null %}
        <p>예약 내역이 없습니다.</p>
        {% else %}
        {% for book in books %}
        <div class="col-sm-4 mb-5">
            <div class="card">
                <div class="card-body">
                    <p class="card-text">호텔 이름 : {{ book.product.info.name }}</p>
                    <hr>
                    <p class="card-text">상품 명 : <a href="{% url 'booking:detail_book' book.pk book.product.pk %}">
                        {{ book.product.title }}
                        </a>
                    </p>
                    <hr>
                    <p class="card-text">예약자 명 : {{ book.name }} </p>
                    <p class="card-text">연락처 : {{ book.phone }}</p>
                    <p class="card-text">가격 : {{ book.product.price }} 원</p>
                    <p class="card-text">이용날짜 : {{ book.product.checkin|date:'Y.m.d' }} ~ {{ book.product.checkout|date:'Y.m.d' }}</p>
                    <hr>
                    <div>    
                    {% if book.state == 0 %}
                        <p class="card-text">예약 상태 : 결제 대기</p>
                        <div class='d-flex justify-content-end'>
                            <a href="{% url 'booking:update_book' book.pk book.product.pk %}">
                                <button class="btn btn-outline-info">결제 하러 가기</button>
                            </a>
                            <a href="{% url 'booking:delete_book' book.pk book.product.pk %}" style="margin-left : 15px">
                                <button class="btn btn-outline-danger">예약 취소</button>
                            </a>
                        </div>
                    {% elif book.state == 1 %}
                    <p class="card-text">예약 상태 : 예약 완료</p>
                    <div class='d-flex justify-content-end'>
                        <a href="{% url 'booking:delete_book' book.pk book.product.pk %}">
                            <button class="btn btn-outline-danger">예약 취소</button>
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
        {% endif %}
    {% endif %}
    <hr>
    <div>
        <form action="{% url 'hotel_accounts:delete_accounts' user %}" method="POST">
            {% csrf_token %}
            <div class='d-flex justify-content-end'>
                <button class="btn btn-outline-danger" onclick="return confirm('탈퇴하시겠습니까?')">회원탈퇴</button>
            </div>
        </form>
    </div>
</section>

{% endblock content %}